{% extends 'base.html.twig' %}

{% block title %}Gestion des Membres - {{ school.name }}{% endblock %}

{% block body %}
<div class="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between pb-6 border-b border-white/5">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight flex items-center space-x-3">
                <i data-lucide="users" class="w-8 h-8 text-primary"></i>
                <span>Gestion des Membres</span>
            </h1>
            <p class="mt-1 text-slate-400">{{ school.name }} • Liste complète des effectifs</p>
        </div>
        <div class="mt-4 sm:mt-0 flex space-x-3">
             <a href="{{ path('membership_requests', {id: school.id}) }}" class="inline-flex items-center px-4 py-2 bg-indigo-500/10 text-indigo-500 hover:bg-indigo-500 hover:text-white rounded-xl text-sm font-bold transition-all relative">
                <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i>
                Demandes en attente
            </a>
            <a href="{{ path('school_show', {id: school.id}) }}" class="inline-flex items-center px-4 py-2 bg-white/5 text-slate-300 hover:bg-white/10 rounded-xl text-sm font-bold transition-all border border-white/10">
                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                Retour
            </a>
        </div>
    </div>

    <div class="bg-dark-gray border border-white/5 rounded-2xl overflow-hidden shadow-2xl">
        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-white/2 border-b border-white/5">
                        <th class="px-6 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500">Membre</th>
                        <th class="px-6 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500">Rôle</th>
                        <th class="px-6 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500">Statut</th>
                        <th class="px-6 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500">Date d'adhésion</th>
                        <th class="px-6 py-4 text-[10px] font-black uppercase tracking-widest text-slate-500 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    <tr class="group hover:bg-white/2 transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary border border-primary/30">
                                    <i data-lucide="shield" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="text-white font-bold">{{ school.owner.firstName|default('') }} {{ school.owner.name|default(school.owner.userIdentifier) }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded text-[8px] uppercase font-black bg-primary text-white tracking-widest">Propriétaire</span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="flex items-center text-emerald-400 text-[10px] font-bold uppercase tracking-wider">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 mr-2"></span>
                                Actif
                            </span>
                        </td>
                        <td class="px-6 py-4 text-xs text-slate-500 font-mono">-</td>
                        <td class="px-6 py-4 text-right"></td>
                    </tr>

                    {% for member in members %}
                        <tr class="group hover:bg-white/2 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 rounded-full {{ member.role == 'admin' ? 'bg-primary/10 text-primary border-primary/20' : 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' }} flex items-center justify-center border transition-transform group-hover:scale-110">
                                        <i data-lucide="{{ member.role == 'admin' ? 'shield' : 'graduation-cap' }}" class="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <div class="text-white font-bold">{{ member.fullName }}</div>
                                        <div class="text-[10px] text-slate-500 uppercase font-mono">{{ member.email }}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                {% if member.role == 'admin' %}
                                    <span class="px-2 py-1 rounded text-[8px] font-black bg-primary/20 text-primary uppercase tracking-widest border border-primary/20">Administrateur</span>
                                {% else %}
                                    <span class="px-2 py-1 rounded text-[8px] font-black bg-emerald-500/20 text-emerald-400 uppercase tracking-widest border border-emerald-500/20">Élève</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4">
                                {% if member.status == 'accepted' %}
                                    <span class="flex items-center text-emerald-400 text-[10px] font-bold uppercase tracking-wider">
                                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 mr-2"></span>
                                        Accepté
                                    </span>
                                {% elseif member.status == 'pending' %}
                                    <span class="flex items-center text-amber-500 text-[10px] font-bold uppercase tracking-wider">
                                        <span class="w-1.5 h-1.5 rounded-full bg-amber-500 mr-2 animate-pulse"></span>
                                        En attente
                                    </span>
                                {% else %}
                                    <span class="flex items-center text-red-500 text-[10px] font-bold uppercase tracking-wider">
                                        <span class="w-1.5 h-1.5 rounded-full bg-red-500 mr-2"></span>
                                        Rejeté
                                    </span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 text-xs text-slate-500 font-mono">
                                {{ member.enrollmentDate|date('d/m/Y') }}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <a href="{{ path('membership_edit_member', {id: member.id}) }}" class="inline-flex items-center p-2 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white rounded-xl transition-all border border-white/5" title="Modifier le rôle/statut">
                                    <i data-lucide="user-cog" class="w-4 h-4 mr-2"></i>
                                    <span class="text-[10px] font-bold uppercase tracking-tighter">Gérer</span>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if members|length == 0 %}
            <div class="p-20 text-center">
                <i data-lucide="users" class="w-12 h-12 text-slate-700 mx-auto mb-4"></i>
                <p class="text-slate-500 font-medium">Aucun autre membre n'a rejoint cet établissement.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
